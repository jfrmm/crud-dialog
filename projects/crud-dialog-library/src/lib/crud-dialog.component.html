<ng-container *ngIf="fields; else loading">
  <div mat-dialog-title>
    <h1 mat-dialog-title>{{ title }}</h1>
  </div>

  <div
    mat-dialog-content
    *ngIf="form"
  >
    <form
      class="form-container"
      [formGroup]="form"
    >
      <div
        fxLayout="row wrap"
        fxLayoutGap="24px"
        fxLayoutAlign="start baseline"
      >
        <div
          *ngFor="let field of fields"
          [ngSwitch]="field.getType"
        >

          <!-- INPUT -->
          <mat-form-field
            *ngSwitchCase="'input'"
            [ngStyle]="{'width': field.elems?.getSize ? field.elems.getSize +'px' : '200px'}"
          >
            <input
              matInput
              type="text"
              [placeholder]="field.elems.getPlaceholder"
              [formControlName]="field.param"
              autocomplete="off"
              [required]="field.elems.getRequired ? field.elems.getRequired : false"
            >

            <mat-error *ngIf="getFormControl(field.param).hasError('required')">
              <span>Field is required</span>
            </mat-error>

            <mat-error *ngIf="getFormControl(field.param).hasError('minLength')">
              <span>
                Field should have, at least, {{ getFormControl(field.param).errors.minlength.requiredLength }} characters
              </span>
            </mat-error>

            <mat-error *ngIf="getFormControl(field.param).hasError('maxLength')">
              <span>
                Field should have, at maximum, {{ getFormControl(field.param).errors.maxlength.requiredLength }} characters
              </span>
            </mat-error>

            <mat-error *ngIf="getFormControl(field.param).hasError('min')">
              <span>
                Field should have a minimum value of {{ getFormControl(field.param).errors.min.min }}
              </span>
            </mat-error>

            <mat-error *ngIf="getFormControl(field.param).hasError('max')">
              <span>
                Field should have a maximum value of {{ getFormControl(field.param).errors.max.max }}
              </span>
            </mat-error>

            <mat-error *ngIf="getFormControl(field.param).hasError('email')">
              <span>Field should be an email</span>
            </mat-error>

            <mat-error *ngIf="getFormControl(field.param).hasError('noSpacesOnly')">
              <span>Field can not be spaces only</span>
            </mat-error>

            <mat-error *ngIf="getFormControl(field.param).hasError('onlyIntegers')">
              <span>Field must be a number</span>
            </mat-error>

            <mat-error *ngIf="field.elems.getErrorsType">
              <ng-container *ngFor="let error of field.elems.getErrorsType.customErrors">
                <mat-error *ngIf="getFormControl(field.param).hasError(error.key) 
                && !getFormControl(field.param).hasError('onlyIntegers') 
                && !getFormControl(field.param).hasError('noSpacesOnly') 
                && !getFormControl(field.param).hasError('email') 
                && !getFormControl(field.param).hasError('max') 
                && !getFormControl(field.param).hasError('min') 
                && !getFormControl(field.param).hasError('maxLength')
                && !getFormControl(field.param).hasError('minLength')
                && !getFormControl(field.param).hasError('required')">{{error.message}}</mat-error>
              </ng-container>
            </mat-error>

          </mat-form-field>

          <!-- LABEL -->
          <div
            *ngSwitchCase="'label'"
            [ngStyle]="{'width': field.elems?.getSize ? field.elems.getSize +'px' : null}"
          >
            <span [innerHtml]="field.elems.getPlaceholder"></span>
          </div>

          <!-- AUTOCOMPLETE -->
          <mat-form-field
            *ngSwitchCase="'autocomplete'"
            [ngStyle]="{'width': field.elems?.getSize ? field.elems.getSize +'px' : '200px'}"
          >
            <input
              type="text"
              matInput
              [formControl]="field.elems.getFormControl"
              [placeholder]="field.elems.getPlaceholder"
              [matAutocomplete]="auto"
              [required]="field.elems.getRequired ? field.elems.getRequired : false"
              focused="false"
            >
            <mat-autocomplete
              autoActiveFirstOption
              #auto="matAutocomplete"
              [displayWith]="fieldHelper.displayField"
            >
              <mat-option
                *ngFor="let fieldOption of field.elems.getOptions | async"
                [value]="fieldOption"
              >
                {{ fieldOption.value }}
              </mat-option>
            </mat-autocomplete>

            <mat-error *ngIf="getFormControl(field.param).hasError('required')">
              <span>Field is required</span>
            </mat-error>

            <mat-error *ngIf="getFormControl(field.param).hasError('onlyObject')">
              <span>Please select a value from the list</span>
            </mat-error>

            <mat-error *ngIf="field.elems.getErrorsType">
              <ng-container *ngFor="let error of field.elems.getErrorsType.customErrors">
                <mat-error *ngIf="getFormControl(field.param).hasError(error.key) 
                && !getFormControl(field.param).hasError('onlyObject')
                && !getFormControl(field.param).hasError('required')">{{error.message}}</mat-error>
              </ng-container>
            </mat-error>

          </mat-form-field>

          <!-- TEXTAREA -->
          <mat-form-field
            *ngSwitchCase="'textArea'"
            [ngStyle]="{'width': field.elems?.getSize ? field.elems.getSize +'px' : '200px'}"
          >
            <mat-label>{{ field.elems.getPlaceholder }}</mat-label>
            <textarea
              matInput
              cdkTextareaAutosize
              #autosize="cdkTextareaAutosize"
              cdkAutosizeMinRows="1"
              cdkAutosizeMaxRows="3"
              [formControl]="field.elems.getFormControl"
              [required]="field.elems.getRequired ? field.elems.getRequired : false"
            ></textarea>

            <mat-error *ngIf="getFormControl(field.param).hasError('required')">
              <span>Field is required</span>
            </mat-error>

            <mat-error *ngIf="getFormControl(field.param).hasError('minLength')">
              <span>
                Field should have, at least, {{ getFormControl(field.param).errors.minlength.requiredLength }} characters
              </span>
            </mat-error>

            <mat-error *ngIf="getFormControl(field.param).hasError('maxLength')">
              <span>
                Field should have, at maximum, {{ getFormControl(field.param).errors.maxlength.requiredLength }} characters
              </span>
            </mat-error>

            <mat-error *ngIf="getFormControl(field.param).hasError('min')">
              <span>
                Field should have a minimum value of {{ getFormControl(field.param).errors.min.min }}
              </span>
            </mat-error>

            <mat-error *ngIf="getFormControl(field.param).hasError('max')">
              <span>
                Field should have a maximum value of {{ getFormControl(field.param).errors.max.max }}
              </span>
            </mat-error>

            <mat-error *ngIf="getFormControl(field.param).hasError('email')">
              <span>Field should be an email</span>
            </mat-error>

            <mat-error *ngIf="getFormControl(field.param).hasError('noSpacesOnly')">
              <span>Field can not be spaces only</span>
            </mat-error>

            <mat-error *ngIf="getFormControl(field.param).hasError('onlyIntegers')">
              <span>Field must be a number</span>
            </mat-error>

            <mat-error *ngIf="field.elems.getErrorsType">
              <ng-container *ngFor="let error of field.elems.getErrorsType.customErrors">
                <mat-error *ngIf="getFormControl(field.param).hasError(error.key) 
                && !getFormControl(field.param).hasError('onlyIntegers') 
                && !getFormControl(field.param).hasError('noSpacesOnly') 
                && !getFormControl(field.param).hasError('email') 
                && !getFormControl(field.param).hasError('max')
                && !getFormControl(field.param).hasError('min')
                && !getFormControl(field.param).hasError('maxLength')
                && !getFormControl(field.param).hasError('minLength')
                && !getFormControl(field.param).hasError('required')">{{error.message}}</mat-error>
              </ng-container>
            </mat-error>
          </mat-form-field>
        </div>
      </div>
    </form>
  </div>
  <div
    mat-dialog-actions
    fxLayoutAlign="end center"
  >
    <button
      mat-raised-button
      color="primary"
      (click)="onClickSave()"
      [disabled]="!form.valid || !form.dirty && fields[0].getType !== 'label'"
    >
      {{ submitButton ? submitButton : 'Submit' }}
    </button>
    <div fxFlex="1"></div>
    <button
      mat-raised-button
      color="warn"
      (click)="onClickCancel()"
      i18n
    >
      {{ cancelButton ? cancelButton : 'Cancel' }}
    </button>
  </div>
</ng-container>
<ng-template #loading>
  <div fxFlexLayout="row">
    <div
      fxFlex
      fxLayoutAlign="center center"
    >
      <mat-spinner></mat-spinner>
    </div>
  </div>
</ng-template>
