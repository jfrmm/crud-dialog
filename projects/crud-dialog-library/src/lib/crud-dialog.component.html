<ng-container *ngIf="fields; else loading">
  <div mat-dialog-title>
    <h1 mat-dialog-title>{{title}}</h1>
  </div>
  <div
    mat-dialog-content
    *ngIf="form"
  >
    <form
      class="form-container"
      [formGroup]="form"
    >
      <div
        fxLayout="row wrap"
        fxLayoutGap="24px"
        fxLayoutAlign="start baseline"
      >
        <div
          *ngFor="let field of fields"
          [ngSwitch]="field.getType"
        >
          <!-- INPUT -->
          <mat-form-field
            *ngSwitchCase="'input'"
            [ngStyle]="{'width': field.elems?.getSize ? field.elems.getSize +'px' : '200px'}"
          >
            <input
              matInput
              type="text"
              [placeholder]="field.elems.getPlaceholder"
              [formControlName]="field.param"
              autocomplete="off"
              [required]="field.elems.getRequired ? field.elems.getRequired : false"
            >
            <mat-error *ngIf="getFormControl(field.param).hasError('required')">
              {{ (field.param).toUpperCase() + ' is required'}}
            </mat-error>
            <mat-error *ngIf="getFormControl(field.param).hasError('minLength')">
              {{ (field.param).toUpperCase() + ' is too short'}}
            </mat-error>
            <mat-error *ngIf="getFormControl(field.param).hasError('maxLength')">
              {{ (field.param).toUpperCase() + ' is too big'}}
            </mat-error>
            <mat-error *ngIf="getFormControl(field.param).hasError('email')">
              {{ (field.param).toUpperCase() + ' is not an email'}}
            </mat-error>
            <mat-error *ngIf="field.elems.getErrorsType">
              <ng-container *ngFor="let error of field.elems.getErrorsType.customErrors">
                <mat-error *ngIf="getFormControl(field.param).hasError(error.key) 
                && !getFormControl(field.param).hasError('email') 
                && !getFormControl(field.param).hasError('maxLength')
                && !getFormControl(field.param).hasError('minLength')
                && !getFormControl(field.param).hasError('required')">{{error.message}}</mat-error>
              </ng-container>
            </mat-error>
          </mat-form-field>
          <!-- LABEL -->
          <div
            *ngSwitchCase="'label'"
            [ngStyle]="{'width': field.elems?.getSize ? field.elems.getSize +'px' : null}"
          >
            <span [innerHtml]="field.elems.getPlaceholder"></span>
          </div>
          <!-- AUTOCOMPLETE -->
          <mat-form-field
            *ngSwitchCase="'autocomplete'"
            [ngStyle]="{'width': field.elems?.getSize ? field.elems.getSize +'px' : '200px'}"
          >
            <input
              type="text"
              matInput
              [formControl]="field.elems.getFormControl"
              [placeholder]="field.elems.getPlaceholder"
              [matAutocomplete]="auto"
              [required]="field.elems.getRequired ? field.elems.getRequired : false"
              focused="false"
            >
            <mat-autocomplete
              autoActiveFirstOption
              #auto="matAutocomplete"
              [displayWith]="fieldHelper.displayField"
            >
              <mat-option
                *ngFor="let fieldOption of field.elems.getOptions | async"
                [value]="fieldOption"
              >
                {{ fieldOption.value }}
              </mat-option>
            </mat-autocomplete>
            <mat-error *ngIf="getFormControl(field.param).hasError('required')">
              {{ (field.param).toUpperCase() + ' is required'}}
            </mat-error>
            <mat-error *ngIf="getFormControl(field.param).hasError('minLength')">
              {{ (field.param).toUpperCase() + ' is too short'}}
            </mat-error>
            <mat-error *ngIf="getFormControl(field.param).hasError('maxLength')">
              {{ (field.param).toUpperCase() + ' is too big'}}
            </mat-error>
            <mat-error *ngIf="getFormControl(field.param).hasError('email')">
              {{ (field.param).toUpperCase() + ' is not an email'}}
            </mat-error>
            <mat-error *ngIf="field.elems.getErrorsType">
              <ng-container *ngFor="let error of field.elems.getErrorsType.customErrors">
                <mat-error *ngIf="getFormControl(field.param).hasError(error.key) 
                && !getFormControl(field.param).hasError('email') 
                && !getFormControl(field.param).hasError('maxLength')
                && !getFormControl(field.param).hasError('minLength')
                && !getFormControl(field.param).hasError('required')">{{error.message}}</mat-error>
              </ng-container>
            </mat-error>
          </mat-form-field>
          <!-- TextArea -->
          <mat-form-field
            *ngSwitchCase="'textArea'"
            [ngStyle]="{'width': field.elems?.getSize ? field.elems.getSize +'px' : '200px'}"
          >
            <mat-label>Leave a comment</mat-label>
            <textarea
              matInput
              [formControl]="field.elems.getFormControl"
              [placeholder]="field.elems.getPlaceholder"
              [required]="field.elems.getRequired ? field.elems.getRequired : false"
            ></textarea>
            <mat-error *ngIf="getFormControl(field.param).hasError('required')">
              {{ (field.param).toUpperCase() + ' is required'}}
            </mat-error>
            <mat-error *ngIf="getFormControl(field.param).hasError('minLength')">
              {{ (field.param).toUpperCase() + ' is too short'}}
            </mat-error>
            <mat-error *ngIf="getFormControl(field.param).hasError('maxLength')">
              {{ (field.param).toUpperCase() + ' is too big'}}
            </mat-error>
            <mat-error *ngIf="getFormControl(field.param).hasError('email')">
              {{ (field.param).toUpperCase() + ' is not an email'}}
            </mat-error>
            <mat-error *ngIf="field.elems.getErrorsType">
              <ng-container *ngFor="let error of field.elems.getErrorsType.customErrors">
                <mat-error *ngIf="getFormControl(field.param).hasError(error.key) 
                && !getFormControl(field.param).hasError('email') 
                && !getFormControl(field.param).hasError('maxLength')
                && !getFormControl(field.param).hasError('minLength')
                && !getFormControl(field.param).hasError('required')">{{error.message}}</mat-error>
              </ng-container>
            </mat-error>
          </mat-form-field>
        </div>
      </div>
    </form>
  </div>
  <div
    mat-dialog-actions
    fxLayoutAlign="end center"
  >
    <button
      mat-raised-button
      color="primary"
      (click)="onClickSave()"
      [disabled]="!form.valid || !form.dirty && fields[0].getType !== 'label'"
    >
      {{ submitButton ? submitButton : 'Submit' }}
    </button>
    <div fxFlex="1"></div>
    <button
      mat-raised-button
      color="warn"
      (click)="onClickCancel()"
      i18n
    >
      {{ cancelButton ? cancelButton : 'Cancel' }}
    </button>
  </div>
</ng-container>
<ng-template #loading>
  <div fxFlexLayout="row">
    <div
      fxFlex
      fxLayoutAlign="center center"
    >
      <mat-spinner></mat-spinner>
    </div>
  </div>
</ng-template>
